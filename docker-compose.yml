version: '3.8'

services:
  uploader:
    # 构建配置
    build: .
    # 镜像名称
    image: node:18-alpine
    # 命令
    command: /bin/sh -c "npm install --include=dev && npm run build && npm install -g serve && serve -s dist -l 3000"
    # 工作目录
    working_dir: /app
    # 容器名称
    container_name: emos
    # 端口映射
    ports:
      - "127.0.0.1:8000:3000"
    # 重启策略
    restart: unless-stopped
    # 环境变量
    environment:
      - NODE_ENV=production
      - VITE_API_BASE_URL=https://your-api-endpoint.com
    # 可选：挂载环境变量文件
    # env_file:
    #   - .env.production
    # 数据卷挂载
    volumes:
      - ./src:/app/src
      - ./dist:/app/dist
      - ./.env.production:/app/.env.production

# 使用说明：
# 1. 构建并运行服务：docker-compose up -d
# 2. 停止并移除服务：docker-compose down
# 3. 查看服务状态：docker-compose ps
# 4. 查看服务日志：docker-compose logs -f

# 注意：使用 docker-compose up -d 命令会自动构建镜像并运行容器，
# 容器会在启动时执行构建、安装 serve 并启动服务